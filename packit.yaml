# See https://packit.dev/docs/configuration/

specfile_path: tmp/rpm/selinux-policy.spec

actions:
  post-upstream-clone:
    - .copr/make-srpm.sh tmp/rpm srcdir
  create-archive: sh -c 'ls tmp/rpm/selinux-policy*.tar.gz'

jobs:
  - job: copr_build
    trigger: pull_request
    targets:
    - fedora-development
    - fedora-latest-stable

  # run tests for packages which test SELinux policy well, see plans/ with `revdeps == yes`
  - job: tests
    identifier: revdeps
    trigger: pull_request
    targets:
    - fedora-development
    - fedora-latest-stable
    tf_extra_params:
      environments:
        - artifacts:
          - type: repository-file
            id: https://copr.fedorainfracloud.org/coprs/g/cockpit/main-builds/repo/fedora-$releasever/group_cockpit-main-builds-fedora-$releasever.repo
          tmt:
            context:
              revdeps: "yes"
